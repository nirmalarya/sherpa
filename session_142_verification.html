<!DOCTYPE html>
<html>
<head>
    <title>Session 142 - SHERPA Verification Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 20px auto; padding: 20px; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .pass { background-color: #d4edda; border-color: #c3e6cb; }
        .fail { background-color: #f8d7da; border-color: #f5c6cb; }
        .pending { background-color: #fff3cd; border-color: #ffeaa7; }
        h1 { color: #333; }
        h2 { color: #666; margin-top: 0; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 3px; overflow-x: auto; }
        .status { font-weight: bold; }
    </style>
</head>
<body>
    <h1>üèîÔ∏è SHERPA V1 - Session 142 Verification Test</h1>
    <p><strong>Purpose:</strong> Verify backend and frontend are functional before implementing new features</p>
    <p><strong>Test Date:</strong> <span id="test-date"></span></p>

    <div id="test-1" class="test pending">
        <h2>Test 1: Backend Health Check (Port 8001)</h2>
        <div class="status">Status: Testing...</div>
        <div class="result"></div>
    </div>

    <div id="test-2" class="test pending">
        <h2>Test 2: Backend API - GET /api/sessions</h2>
        <div class="status">Status: Testing...</div>
        <div class="result"></div>
    </div>

    <div id="test-3" class="test pending">
        <h2>Test 3: Backend API - GET /api/snippets</h2>
        <div class="status">Status: Testing...</div>
        <div class="result"></div>
    </div>

    <div id="test-4" class="test pending">
        <h2>Test 4: Frontend Accessibility (Port 4173)</h2>
        <div class="status">Status: Testing...</div>
        <div class="result"></div>
    </div>

    <div id="summary" style="margin-top: 30px; padding: 20px; background: #e9ecef; border-radius: 5px;">
        <h2>Test Summary</h2>
        <div id="summary-content">Running tests...</div>
    </div>

    <script>
        document.getElementById('test-date').textContent = new Date().toLocaleString();

        let passCount = 0;
        let failCount = 0;
        let totalTests = 4;

        function updateSummary() {
            const summaryEl = document.getElementById('summary-content');
            const allDone = (passCount + failCount) === totalTests;

            if (allDone) {
                const allPassed = failCount === 0;
                summaryEl.innerHTML = `
                    <p><strong>Tests Complete:</strong> ${passCount} passed, ${failCount} failed</p>
                    <p style="font-size: 24px; color: ${allPassed ? 'green' : 'red'};">
                        ${allPassed ? '‚úÖ All Core Tests PASSED' : '‚ùå Some Tests FAILED'}
                    </p>
                    ${allPassed ? '<p>‚úÖ Backend and API are functional. Safe to proceed with feature work.</p>' : '<p>‚ö†Ô∏è Issues detected. Must fix before implementing new features.</p>'}
                `;
            }
        }

        function markPass(testId, message, data) {
            const testEl = document.getElementById(testId);
            testEl.className = 'test pass';
            testEl.querySelector('.status').textContent = 'Status: ‚úÖ PASS';
            testEl.querySelector('.result').innerHTML = `
                <p>${message}</p>
                ${data ? `<pre>${JSON.stringify(data, null, 2)}</pre>` : ''}
            `;
            passCount++;
            updateSummary();
        }

        function markFail(testId, message, error) {
            const testEl = document.getElementById(testId);
            testEl.className = 'test fail';
            testEl.querySelector('.status').textContent = 'Status: ‚ùå FAIL';
            testEl.querySelector('.result').innerHTML = `
                <p>${message}</p>
                <pre>${error}</pre>
            `;
            failCount++;
            updateSummary();
        }

        // Test 1: Health Check
        async function test1() {
            try {
                const response = await fetch('http://localhost:8001/api/health');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                markPass('test-1', '‚úÖ Backend is healthy and responding', data);
            } catch (error) {
                markFail('test-1', '‚ùå Backend health check failed', error.message);
            }
        }

        // Test 2: Sessions API
        async function test2() {
            try {
                const response = await fetch('http://localhost:8001/api/sessions');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                markPass('test-2', `‚úÖ Sessions API working (${Array.isArray(data) ? data.length : 0} sessions)`,
                    Array.isArray(data) ? `Found ${data.length} sessions` : data);
            } catch (error) {
                markFail('test-2', '‚ùå Sessions API failed', error.message);
            }
        }

        // Test 3: Snippets API
        async function test3() {
            try {
                const response = await fetch('http://localhost:8001/api/snippets');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                const count = Array.isArray(data) ? data.length : (data.snippets ? data.snippets.length : 0);
                markPass('test-3', `‚úÖ Snippets API working (${count} snippets)`,
                    `Found ${count} snippets including built-in knowledge`);
            } catch (error) {
                markFail('test-3', '‚ùå Snippets API failed', error.message);
            }
        }

        // Test 4: Frontend
        async function test4() {
            try {
                const response = await fetch('http://localhost:4173/');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const html = await response.text();
                if (html.includes('root') || html.includes('SHERPA') || html.includes('vite')) {
                    markPass('test-4', '‚úÖ Frontend is accessible and serving content',
                        'Frontend is running on port 4173 (Vite preview mode)');
                } else {
                    markFail('test-4', '‚ùå Frontend returned unexpected content', 'HTML does not contain expected markers');
                }
            } catch (error) {
                markFail('test-4', '‚ùå Frontend accessibility failed', error.message);
            }
        }

        // Run all tests
        async function runAllTests() {
            await test1();
            await test2();
            await test3();
            await test4();
        }

        runAllTests();
    </script>
</body>
</html>
